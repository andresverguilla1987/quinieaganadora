<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Quiniela PRO — Fix</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="top"><h1>Quiniela PRO — Fix</h1><p class="sub">Predicciones con estadística — API_BASE corregida</p></header>
  <main class="wrap">
    <div class="controls">
      <button id="refresh">Actualizar partidos</button>
      <button id="gen">Generar picks</button>
    </div>
    <section class="card">
      <h2>Picks</h2>
      <pre id="picks">Sin datos — presiona Generar picks</pre>
    </section>
    <section class="card">
      <h2>Partidos</h2>
      <ul id="matches"><li>Cargando partidos…</li></ul>
    </section>
    <footer class="foot">Hecho con ❤️ — Netlify + Render</footer>
  </main>
<script>
const API_BASE = "https://quinieaganadora.onrender.com";

async function api(path){ 
  const res = await fetch(API_BASE + path);
  if(!res.ok) throw new Error('status ' + res.status);
  return res.json();
}

async function loadMatches(){
  const el = document.getElementById('matches');
  el.innerHTML = '<li>Cargando partidos…</li>';
  try{
    const data = await api('/matches');
    if(!Array.isArray(data) || data.length===0){ el.innerHTML = '<li>Sin partidos</li>'; return; }
    el.innerHTML = data.map(function(m){
      const d = new Date(m.date||m.utc||m.utc_date||Date.now());
      return '<li><strong>'+ d.toLocaleString() +'</strong> — '+ (m.home||'Home') +' vs '+ (m.away||'Away') +' <button data-id="'+(m.id||'')+'" class="det">Detalles</button> <span class="pred">'+(m.prediction||'—')+'</span></li>';
    }).join('');
  }catch(err){
    el.innerHTML = '<li>Error fetching matches ('+err+')</li>';
    console.error(err);
  }
}

async function generatePicks(){
  const p = document.getElementById('picks');
  p.innerText = 'Generando picks...';
  try{
    const res = await api('/generate-picks');
    p.innerText = JSON.stringify(res, null, 2);
  }catch(err){
    p.innerText = 'Error generando picks: ' + err;
  }
}

document.getElementById('refresh').addEventListener('click', loadMatches);
document.getElementById('gen').addEventListener('click', generatePicks);
window.addEventListener('load', ()=>{ loadMatches(); });
</script>
</body>
</html>
